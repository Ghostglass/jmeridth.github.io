<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta charset="utf-8"><meta name="author" content="Jason Meridth"><title>PTOM: November 2008: Visitor Design Pattern | Jason Meridth's Blog</title><link href="../../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="../../assets/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"><link href="../../assets/css/rst.css" rel="stylesheet" type="text/css"><link href="../../assets/css/code.css" rel="stylesheet" type="text/css"><link href="../../assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="../../assets/css/theme.css" rel="stylesheet" type="text/css"><link rel="canonical" href="http://blog.jasonmeridth.com/posts/ptom-november-2008-visitor-design-pattern/"><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml"></head><body>
<!-- Menubar -->
<div class="navbar navbar-fixed-top" id="navbar">
    <div class="navbar-inner">
        <div class="container">

        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>

            <a class="brand" href="http://blog.jasonmeridth.com/">
            Jason Meridth's Blog
            </a>
            <!-- Everything you want hidden at 940px or less, place within here -->
            <div class="nav-collapse collapse">
                <ul class="nav"><li><a href="../../archive.html">Archives</a>
            
        
    
        
            
                </li><li><a href="../../categories/index.html">Tags</a>
            
        
    
        
            
                </li><li><a href="https://github.com/jmeridth"><img src="http://b038a8f209e36fc36fba-a9b634eed6b534d774260bd8467c190d.r61.cf1.rackcdn.com/github.png" border="0"></a>
            
        
    
        
            
                </li><li><a href="http://twitter.com/jmeridth"><img src="http://b038a8f209e36fc36fba-a9b634eed6b534d774260bd8467c190d.r61.cf1.rackcdn.com/twitter.png" border="0"></a>
            
        
    
        
            
                </li><li><a href="../../rss.xml"><img src="http://b038a8f209e36fc36fba-a9b634eed6b534d774260bd8467c190d.r61.cf1.rackcdn.com/rss.png" border="0"></a>
            
        
    

                </li></ul><!-- Custom search with google--><form id="search" action="http://google.com/search" method="get" class="navbar-form pull-left">
<input type="hidden" name="q" value="site:http://blog.jasonmeridth.com/"><input type="text" name="q" maxlength="255" results="0" placeholder="Search"></form>
<!-- End of custom search -->

                
                <ul class="nav pull-right"></ul></div>
        </div>
    </div>
</div>
<!-- End of Menubar -->
<div class="container-fluid" id="container-fluid">
    <!--Body content-->
    <div class="row-fluid">
    <div class="span2"></div>
    <div class="span8">
    
    <article class="postbox post-text"><div class="h-entry" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    <h1 class="p-name" itemprop="headline name">PTOM: November 2008: Visitor Design Pattern</h1>
    

    <hr><small>
        Posted: <time class="published dt-published" datetime="2008-11-30T21:15:00-06:00" itemprop="datePublished">Nov 30, 2008</time>
        
    

		
    

          |  
		
		
			<a href="index.md" id="sourcelink">Source</a>
		
		
    </small>
    <hr><div class="e-content" itemprop="articleBody text">
    <div><h3>Definition</h3>
<p>Visitor Design Pattern - <em>"_Represent an operation to be performed on the elements of an object structure. Visitor lets you define a new operation without changing the classes of the elements on which it operates. " <a href="http://dofactory.com/Patterns/PatternVisitor.aspx">dofactory.com</a> Another term you may hear when working with the Visitor Pattern, is <a href="http://en.wikipedia.org/wiki/Double_dispatch">Double Dispatch</a>.  How that applies to Visitor is that the accept method takes a visitor instance, which in turn  has a visit method that takes the concrete instance (aka "this").  Inside the visitor visit method is where the core of the visitor pattern occurs.  It is where you can extend the concrete class without actually editing the concrete class. </em><img alt="image" src="//lostechies.com/jasonmeridth/files/2011/03/image_thumb.png">_</p>
<h3>Open Closed Principle (OCP)</h3>
<p>"...using the visitor pattern helps conformance with the open/closed principle." (<a href="http://en.wikipedia.org/wiki/Visitor_pattern">Wikipedia</a>)  The <a href="../../blogs/joe_ocampo/archive/2008/03/21/ptom-the-open-closed-principle.aspx">Open/Closed Principle</a> is that "a class is open for extension, closed for modification". (<a href="http://en.wikipedia.org/wiki/Open_Closed_Principle">Thank you Mr. Meyer</a>)  I recently used the Visitor pattern inline with usage of a State Pattern.  The Visitor would be able to determine, based on it's algorithms, which was changing regularly by the needs of the end user, whether an object could move to the next state in the machine.  Adhering to our theme, a coffee shop, I decided to generat a paycheck stub .  My C# example is showing how to report the coffee shop employees earned wages, deductions via sick days and number of vacation days taken: </p>
<h3>C# Code</h3>
<p>Test Firsts (NUnit): [gist id=1067984] I have two test fixtures, one for hourly employees and one for full-time employees.  Hopefully, via my rough version of Behavior Driven Development (BDD), you can read my tests without any problems. Implementation: [gist id=1067988] Please remember, this is "blog friendly" code.  I would definitely break the visitor class apart into a few classes (i.e., WageCalculator, SickPayDeductionCalculator, etc). </p>
<h3>Ruby Code</h3>
<p>Please understand that I'm a Ruby newbie and I'm petty sure there is a more "Ruby-ish" way to do this._ _I've recently been placed on a Ruby team and I'm making the transition from the static language mind-set to the dynamic language mind-set.  I do understand with mix-ins you can dynamically add functionality to a class based on context, so visitor may not be necessary at all.  I'm still grokking that concept.  I still believe in the Open/Closed principle, but it may be moot with dynamic languages. It's actually very exciting being a newbie developer again.  It feeds my insatiable need to learn. Test (Using RSpec): [gist id=1067994] Implementation: [gist id=1067996] </p>
<h3>What I Learned</h3>
<p>I personally use the strategy pattern more than any other pattern.  That is why I chose this pattern.  So I could understand it better. A good example I saw recently, using lambdas and all the new .NET features was <a href="http://mokhan.ca/blog/CommentView,guid,0480cc5f-54e4-452f-b0d5-661f0a8289d7.aspx#commentstart">Chad's comment</a> (<a href="http://pastie.org/245770">pastie.org</a>) on <a href="http://mokhan.ca/blog/2008/08/01/Recursive+Command.aspx">Mo's Recursive Command Post</a> Hope this helps someone understand the Visitor Design Pattern better.</p></div>
    </div>
    
    </div>
    
    
        <ul class="pager"><li class="previous">
                <a href="../library-thing/" rel="prev">← Previous post</a>
            </li>
        
        
            <li class="next">
                <a href="../twitterfeed-com-killed-the-my-google-reader/" rel="next">Next post →</a>
            </li>
        
        </ul><div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="jasonmeridth",
        
            disqus_url="http://blog.jasonmeridth.com/posts/ptom-november-2008-visitor-design-pattern/",
        
        disqus_title="PTOM: November 2008: Visitor Design Pattern",
        disqus_identifier="cache/posts/ptom-november-2008-visitor-design-pattern.html",
        disqus_config = function () {
            this.language = "";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>
    

    

    
    
    

    </article></div>
    </div>
    <!--End of body content-->
</div>
<div class="footerbox">
    Contents © 2014         <a href="mailto:jason@jasonmeridth.com">Jason Meridth</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<br><br><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/2.5/ar/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="http://i.creativecommons.org/l/by-nc-sa/2.5/ar/88x31.png"></a>
</div>

    
        
            <script src="../../assets/js/jquery-1.10.2.min.js" type="text/javascript"></script><script src="../../assets/js/bootstrap.min.js" type="text/javascript"></script><script src="../../assets/js/jquery.colorbox-min.js" type="text/javascript"></script><!-- Social buttons --><div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul><li><a class="addthis_button_facebook"></a>
</li><li><a class="addthis_button_google_plusone_share"></a>
</li><li><a class="addthis_button_linkedin"></a>
</li><li><a class="addthis_button_twitter"></a>
</li></ul></div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script><!-- End of social buttons --><script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});
    $(window).on('hashchange', function(){
        if (location.hash && $(location.hash)[0]) {
            $('body').animate({scrollTop: $(location.hash).offset().top - $('#navbar').outerHeight(true)*1.2 }, 1);
        }
    });
    $(document).ready(function(){$(window).trigger('hashchange')});
    </script></body></html>