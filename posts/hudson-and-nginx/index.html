<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Hudson and Nginx | Jason Meridth's Blog</title>

                <link href="../../assets/css/bitter.css" rel="stylesheet" type="text/css">
        <link href="../../assets/css/main.css" rel="stylesheet" type="text/css">
        <link href="../../assets/css/rst.css" rel="stylesheet" type="text/css">
        <link href="../../assets/css/code.css" rel="stylesheet" type="text/css">

                <link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">

      <link rel="canonical" href="http://blog.jasonmeridth.com/posts/hudson-and-nginx/">



    
        <!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->

    

    
    <meta name="author" content="Jason Meridth">
            <meta name="og:title" content="Hudson and Nginx">
        <meta name="og:url" content="http://blog.jasonmeridth.com/posts/hudson-and-nginx/">
            <meta name="og:description" content="UPDATE: I left HTTP Auth in place via Nginx and removed security from my Hudson instance. This works for me because I don't need the Hudson security. Every developer should be able to manage the CI se">
        <meta name="og:site_name" content="Jason Meridth's Blog">
        <meta name="og:type" content="article">

    
    

</head>
<body>
    <section class="social">
        <ul>
                    <li><a href="../../index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="http://jasonmeridth.com" title="About Me"><i class="icon-user"></i></a></li>
            <li><a href="../../archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="../../categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="https://github.com/jmeridth" title="Github"><i class="icon-github"></i></a></li>
            <li><a href="https://twitter.com/jmeridth" title="Twitter"><i class="icon-twitter"></i></a></li>
            <li><a href="../../rss.xml" title="RSS"><i class="icon-rss"></i></a></li>

        </ul>
    </section>
    <section class="page-content">
        <div class="content" rel="main">
    <div class="post">
        <h1 class="p-name entry-title" itemprop="headline name">Hudson and Nginx</h1>

        <div class="meta">
            <div class="authordate">
                <time class="timeago" datetime="2009-02-12T04:46:00-06:00">Feb 12, 2009</time>
            
            
            </div>
            
        </div>
        <div class="body">
            <p>UPDATE: I left HTTP Auth in place via Nginx and removed security from my Hudson instance. This works for me because I don't need the Hudson security. Every developer should be able to manage the CI server. I'm just trying to prevent external access to the dashboard.</p>
<p>I've been having fun trying to figure out how to block a user's ability of going to http://mydomain:8080 and bypassing my 80 to 443 redirect and htpasswd HTTP basic authentication. I even went as far as removing Nginx and installing Apache. According to the Hudson site, we can use <a href="http://hudson.gotdns.com/wiki/display/HUDSON/Apache+frontend+for+security">Apache to do this</a>. Either I'm not smart enough or web pages like this reminded me why I hate the Java Enterprise stack as much as I do. Talk about installation obfuscation. My problem exists because the Tomcat instance running the hudson war file uses <a href="http://tomcat.apache.org/tomcat-5.5-doc/config/ajp.html#Standard%20Implementation">Apache JServe Protocol</a> (AJP) and will allow direct access on whatever port you used (default 8080). This is even if you proxy_pass to 8080 from 443 (SSL) or 80 (Web). Through testing and research it seems that <a href="http://www.ruby-forum.com/topic/157269#693042">Nginx does not have a solution for this</a>. I can't allow access to my Hudson instance from external users. I have a self-signed certificate and a .htpasswd file to protect the instance, but is all useless is someone could just type in http://mydomain.com:8080. I want that redirected to https://mydomain.com which will then proxy internally to http://127.0.0.1:8080. I didn't want to fight this, so I just used iptables (linux firewall) to block external requests on port 8080 but allow internal requests to 8080. Here is the entry in my iptables file: </p>
<pre class="code literal-block"><span class="cp"># Deny HTTP requests to port 8080 externally but allow internally</span>
<span class="o">-</span><span class="n">A</span> <span class="n">INPUT</span> <span class="o">-</span><span class="n">i</span> <span class="n">eth0</span> <span class="o">-</span><span class="n">p</span> <span class="n">tcp</span> <span class="o">-</span><span class="n">m</span> <span class="n">tcp</span> <span class="o">--</span><span class="n">dport</span> <span class="mi">8080</span> <span class="o">-</span><span class="n">j</span> <span class="n">REJECT</span>
</pre>


<p>I only allow access to my server via 80 (web), 443 (ssl) and my ssh port (I'm not telling). This works for now, but I'm experiencing another weird issue. I follow the Nginx way of using HTTP basic authentication: </p>
<pre class="code literal-block"><span class="n">location</span>  <span class="o">/</span>  <span class="p">{</span>      
 <span class="n">auth_basic</span>            <span class="s">"Restricted"</span><span class="p">;</span>
 <span class="n">auth_basic_user_file</span>  <span class="n">conf</span><span class="o">/</span><span class="n">htpasswd</span><span class="p">;</span>
<span class="p">}</span>
</pre>


<p>If the user listed in the <a href="http://httpd.apache.org/docs/2.0/programs/htpasswd.html">htpasswd</a> file is also a registered user on the Hudson instance (through the Hudson UI) then the HTTP basic authentication will work. If they are in the htpasswd file but not registered with Hudson, it fails with a HTTP 401 (Unauthorized). Why would the HTTP basic authentication be "tunneled" through to Hudson? I'll update this post once I figure it out.</p>
        </div>
                <ul class="pager">
            <li class="previous">
                <a href="../selenium-client-and-fun/" rel="prev" title="Selenium-client and fun">Previous post</a>
            </li>
            <li class="next">
                <a href="../current-status/" rel="next" title="Current Status">Next post</a>
            </li>
        </ul>

                            <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="jasonmeridth",
            disqus_url="http://blog.jasonmeridth.com/posts/hudson-and-nginx/",
        disqus_title="Hudson and Nginx",
        disqus_identifier="cache/posts/hudson-and-nginx.html",
        disqus_config = function () {
            this.language = "";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        
    </div>
                    <footer id="footer" role="contentinfo">
            <p>Contents Â© 2014         <a href="mailto:jason@jasonmeridth.com">Jason Meridth</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>

        </div>
    </section>
    
    
                <script src="../../assets/js/jquery-1.10.2.min.js" type="text/javascript"></script>
            <script src="../../assets/js/jquery.timeago.js" type="text/javascript"></script>
    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul>
<li>
<a class="addthis_button_facebook"></a>
</li>
<li>
<a class="addthis_button_google_plusone_share"></a>
</li>
<li>
<a class="addthis_button_linkedin"></a>
</li>
<li>
<a class="addthis_button_twitter"></a>
</li>
</ul>
</div>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


        <script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>
